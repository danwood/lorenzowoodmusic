var encode83=function(a,o){for(var t="",r=1;r<=o;r++){var e=Math.floor(a)/Math.pow(83,o-r)%83;t+=digitCharacters[Math.floor(e)]}return t},bytesPerPixel=4,multiplyBasisFunction=function(a,o,t,r){for(var e=0,n=0,i=0,h=o*bytesPerPixel,l=0;l<o;l++)for(var c=0;c<t;c++){var f=r(l,c);e+=f*sRGBToLinear(a[bytesPerPixel*l+0+c*h]),n+=f*sRGBToLinear(a[bytesPerPixel*l+1+c*h]),i+=f*sRGBToLinear(a[bytesPerPixel*l+2+c*h])}var s=1/(o*t);return[e*s,n*s,i*s]},encodeDC=function(a){var o,t,r;return(linearTosRGB(a[0])<<16)+(linearTosRGB(a[1])<<8)+linearTosRGB(a[2])},encodeAC=function(a,o){var t,r,e;return 19*Math.floor(Math.max(0,Math.min(18,Math.floor(9*signPow(a[0]/o,.5)+9.5))))*19+19*Math.floor(Math.max(0,Math.min(18,Math.floor(9*signPow(a[1]/o,.5)+9.5))))+Math.floor(Math.max(0,Math.min(18,Math.floor(9*signPow(a[2]/o,.5)+9.5))))},encode=function(a,o,t,r,e){if(r<1||r>9||e<1||e>9)throw new ValidationError("BlurHash must have between 1 and 9 components");if(o*t*4!==a.length)throw new ValidationError("Width and height must match the pixels array");for(var n=[],i=function(e){for(var i=function(r){var i=0==r&&0==e?1:2,h=multiplyBasisFunction(a,o,t,(function(a,n){return i*Math.cos(Math.PI*r*a/o)*Math.cos(Math.PI*e*n/t)}));n.push(h)},h=0;h<r;h++)i(h)},h=0;h<e;h++)i(h);var l=n[0],c=n.slice(1),f="",s,M;if(f+=encode83(r-1+9*(e-1),1),c.length>0){var u=Math.max.apply(Math,c.map((function(a){return Math.max.apply(Math,a)}))),d=Math.floor(Math.max(0,Math.min(82,Math.floor(166*u-.5))));M=(d+1)/166,f+=encode83(d,1)}else M=1,f+=encode83(0,1);return f+=encode83(encodeDC(l),4),c.forEach((function(a){f+=encode83(encodeAC(a,M),2)})),f};